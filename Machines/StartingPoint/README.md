<h3>Разберем подробно каждую команду и используемые вместе с ней параметры</h3>

```bash
ports=$(nmap -p- --min-rate=1000 -T4 10.10.10.27 | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)
```
Переменная ```ports``` инициализируется списком портов, которые затем будут использованы для сканирования портов на целевом хосте 10.10.10.27
```
nmap -p- --min-rate=1000 -T4 10.10.10.27
``` 
Команда ```nmap``` в примере выше выполняет поиск по всем 65535 портам, на это указывает параметр <em><b>"-p-"</b></em>. 

<em><b>```--min-rate```=1000</b></em> фиксирует количество отправляемых пакетов в секунду не меньше заданного значения, в нашем случае оно равно 1000.

<em><b>```-T4```</b></em> задает временной интервал для отправки пакетов на хост. Задается в интервале [1-5], чем больше число, тем быстрее скорость отправки. 
В этом случае команда будет иметь следующий вывод:
```
Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-14 18:20 MSK
Warning: 10.10.10.27 giving up on port because retransmission cap hit (6).
Nmap scan report for 10.10.10.27
Host is up (0.12s latency).
Not shown: 54091 closed ports, 11434 filtered ports
PORT      STATE SERVICE
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
1433/tcp  open  ms-sql-s
5985/tcp  open  wsman
47001/tcp open  winrm
49664/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 287.55 seconds
```
Далее за символом перенаправления вывода "трубы" ```|``` следует команда:
```
grep ^[0-9]
```
<em><b>```grep```</b></em> выполняет поиск образца в текстовых файлах и выдает все строки, содержащие этот образец.
В качестве образца используется регулярное выражение <em><b>(regex)</b></em>, которое определяет первый символ с помощью оператора ```^``` из диаппазона значений [0-9],
то есть все строки, начинающиеся с цифры от 1 до 9.

Учитывая что на вход подается результат работы команды ```nmap -p- --min-rate=1000 -T4 10.10.10.27```,
теперь вывод будет иметь следующий вид:
```
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
1433/tcp  open  ms-sql-s
5985/tcp  open  wsman
47001/tcp open  winrm
49664/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
```
Как видно, на выходе остались только строки, содержащие в себе номера портов, которые удалось обнаружить благодаря утилите <em><b>nmap</b></em>.

Далее следует выполнение утилиты <em><b>```cut```</b></em>:
```
cut -d '/' -f 1 
```
Команда <em>cut</em> выделяет столбцы текста (части строк) из данных и отправляет в стандартный поток вывода.

<em><b>```-d, --delimiter```</b></em>=РАЗДЕЛИТЕЛЬ задает РАЗДЕЛИТЕЛЬ колонок (полей) входных данных вместо символа табуляции. Применяется совместно с опцией -f.
В нашем случае разделителем служит знак слэш ```/```.

```-f, --fields```=СПИСОК выводит только столбцы (поля), перечисленные в СПИСКЕ. По умолчанию столбцы разделяются символами табуляции. Параметр <em><b>```-f```</b></em>
с аргументом равным ```1``` задает в качестве СПИСКА первый столбец.

Вывод этой утилиты дает следующий результат:
```
135
139
445
1433
5985
47001
49664
49666
49667
49668
```
Следующие две команды рассмотрим вместе, так как они связаны друг с другом.
Имеем список (столбец) портов, которые нужно преобразовать в строку так, чтобы номера портов были разделены между собой запятыми.
Это необходимо для того, чтобы в конечном итоге сформировалась строка, которую можно передать в качестве аргумента парамтра <em><b>```-p```</b></em> утилиты <em><b>nmap</b></em>.
```
tr '\n' ',' | sed s/,$//
```
```tr```
выполняет преобразование, подстановку (замену), сокращение и/или удаление символов, поступающих со стандартного ввода, записывая результат на стандартное устройство вывода.
Она часто применяется для удаления управляющих символов из файла или преобразования регистра символов. Как правило, команде <em><b>tr</b></em> передаются две строки (набора) символов: 
первый набор СТРОКА_1 содержит искомые символы, а второй СТРОКА_2 - те, на которые их следует заменить. 
При запуске команды устанавливается соответствие между символами обоих наборов, а затем начинается преобразование.

В нашем случае все управляющие символы ```\n``` - перенос строки, будут заменены запятой. в результате получим строку вида:
```
135,139,445,1433,5985,47001,49664,49666,49667,49668,
```
Последняя строка ```49668``` в столбце очевидно тоже содержит управляющй символ переноса строки, и в результате замены у он был изменен на знак запятой. Для того, чтобы запрос
<em><b>nmap</b></em> выполнился без ошибок, запятой вконце строки быть не должно. Именно для этого наша строка подается на вход утилиты ```sed```.

<em><b>sed</b></em> это редактор потока. Потоковый редактор используется для выполнения основных преобразований с текстом на входном потоке (файл или ввод из конвейера).

Параметр ```s/``` служит указателем на регулярное выражение и имеет следующий синтаксис ```s/регулярное_выражение/замена/```. В качестве регулярного выражения используется символ конца строки ```$```.
Таким образом находим последний символ в конце нашей строки, а именно запятую и заменяем ее на пустое значение, так как в параметре мы ничего не передаем для замены ```s/,$//```.
В итоге получаем строку, в которой записаны найденные порты, но уже без ЗАПЯТОЙ вконце.
```
135,139,445,1433,5985,47001,49664,49666,49667,49668
```
Эта строка и записывается в переменную $ports, что можно проверить выполнив команду
```bash
echo $ports
```




